<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Piotr Lemancewicz" />


<title>Analiza porównawcza ryzyka w modelach klasy GARCH dla portfela wybranych aktywów</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Piotr Lemancewicz</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="GARCH_practise.html">GARCH models comparison</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Analiza porównawcza ryzyka w modelach klasy GARCH dla portfela wybranych aktywów</h1>
<h4 class="author">Piotr Lemancewicz</h4>
<h4 class="date">28 07 2019</h4>

</div>


<p>Głownym celem tego dokumentu jest zaprezentowanie mojego zainteresowania ekonometrią finansową w praktyczny i namacalny sposób. Rozkłady danych zostaną zaprezentowane przez różne wykresy i scharakteryzowane specyficznymi statystkami, a także zostaną oszacowane różne modele GARCH, służące do modelowania warunkowej wariancji. Wyliczone zostaną także wartości zagrożone (VaR) i oczekiwana strata (ES). VaR może być zdefiniowany jako maksymalny poziom straty dla (1-p)% obserwacji, natomiast ES jako oczekiwana strata wśród q% najgorszych scenariuszy. Stworzone modele zostaną porównane między sobą pod względem dopasowania i predykcji rzeczywistych wydarzeń w przeszłości.</p>
<p>Dane dotyczą cen zamknięcia akcji GLUU MOBILE INC i Activision Blizzard Inc, które pobrane zostały ze strony stooq.com. Zbudowano z nich portfel z wagami (0.5,0.5). Następnie obliczono logarytmiczne stopy zwrotu portfela, które zazwyczaj charakteryzują się stacjonarnością.</p>
<pre class="r"><code>#Load packages
library(zoo)
library(moments)
library(forecast)
library(tseries)
library(knitr)
library(FinTS)
library(rugarch)
library(urca)
library(xts)
library(quantmod)</code></pre>
<pre class="r"><code>#Prepare data
filename1 &lt;-&quot;https://stooq.pl/q/d/l/?s=atvi.us&amp;d1=20110103&amp;d2=20190705&amp;i=d&quot;
filename2 &lt;-&quot;https://stooq.pl/q/d/l/?s=gluu.us&amp;d1=20110103&amp;d2=20190705&amp;i=d&quot;
x1 &lt;- read.csv(filename1)
x2 &lt;- read.csv(filename2)
y1 &lt;- zoo(x1$Zamkniecie, as.Date(x1$Data))
y2 &lt;- zoo(x2$Zamkniecie, as.Date(x2$Data))
y &lt;- cbind(y1,y2)
names(y) &lt;- c(&quot;ATVI&quot;,&quot;GLUU&quot;)
dates&lt;-index(y) 
startDate &lt;- as.Date(&quot;2011-01-03&quot;)
endDate   &lt;- as.Date(&quot;2019-07-03&quot;)
y         &lt;- window(y, start=startDate, end=endDate)
w   &lt;- c(0.5,0.5) # porfolio weights
dy  &lt;- 100*diff(log(y)) # log returns of stocks
r   &lt;- zoo(dy%*%w,index(dy)) # portfolio returns
R   &lt;- as.numeric(coredata(r))
P   &lt;- exp(cumsum(r/100)) # the value of investment in the portfolio</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>W kolejnym kroku obliczono podstawowe statystyki rozkładu zwrotów. Kurtoza wynosząca 6,77 sugeruje dużą koncentrację wokół średniej. Na poziomie istotności 5% odrzucono hipotezę zerową z testu Jarque-Bera zakładającą, że rozkład stóp zwrotu portfela akcji jest normalny.</p>
<pre class="r"><code>Nyear &lt;- 365/as.numeric(mean(diff(dates)))
mu    &lt;- mean(r)*Nyear
sig   &lt;- sd(r)*sqrt(Nyear) 
mom &lt;- as.data.frame(c(Nyear,mu,sig,min(r),max(r), skewness(r), kurtosis(r),jarque.bera.test(R)$stat))
rownames(mom) &lt;- c(&quot;N&quot;,&quot;mu&quot;,&quot;sig&quot;,&quot;min&quot;,&quot;max&quot;,&quot;skew&quot;,&quot;kurt&quot;, &quot;JB test&quot;); colnames(mom)=&quot;value&quot;
kable(mom, digits=3)</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>N</td>
<td align="right">251.327</td>
</tr>
<tr class="even">
<td>mu</td>
<td align="right">15.886</td>
</tr>
<tr class="odd">
<td>sig</td>
<td align="right">39.067</td>
</tr>
<tr class="even">
<td>min</td>
<td align="right">-14.757</td>
</tr>
<tr class="odd">
<td>max</td>
<td align="right">14.093</td>
</tr>
<tr class="even">
<td>skew</td>
<td align="right">0.010</td>
</tr>
<tr class="odd">
<td>kurt</td>
<td align="right">6.771</td>
</tr>
<tr class="even">
<td>JB test</td>
<td align="right">1266.370</td>
</tr>
</tbody>
</table>
<p>W celu sprawdzenia czy na przykład rozkład t-studenta dobrze opisuje rozkład zwrótów stworzone zostały dodatkowe graficzne porównania (wykres funkcji gęstości i wykres kwanty-kwantyl).</p>
<pre class="r"><code># Density plot
Rstar &lt;- (R-mean(R))/sd(R)
d     &lt;- density(Rstar) # returns the density data 
xlim = c(min(Rstar),max(Rstar)); ylim = c(-0.02,max(d$y)+0.1)
# xlim = c(min(Rstar),-2); ylim = c(-0.01,0.05)
par(mfrow=c(1,1), cex = 0.75, bty=&quot;l&quot;)
plot(d, main=&quot;Funkcja gęstości&quot;, ylab = &quot;Gęstość&quot;, xlim = xlim, ylim = ylim, lwd=2,xlab=&quot;&quot;) 
xfit &lt;-seq(min(Rstar),max(Rstar),length=100);
# normal distribution
yfit &lt;-dnorm(xfit,0,1); lines(xfit, yfit, lwd=1, col=&quot;red&quot;) 
# t-Student distribution
v = 4 + 6/(kurtosis(R)-3)
yfit &lt;-ddist(&quot;std&quot;,y=xfit,shape=v);   lines(xfit, yfit, lwd=1, col=&quot;blue&quot;) 
legend(-4,0.5,c(&quot;Empiryczny&quot;,&quot;Normalny&quot;,&quot;t-Student&quot;), col=c(&quot;black&quot;,&quot;red&quot;,&quot;blue&quot;),bty=&quot;n&quot;,lty=c(1,1,1))</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Na wykresie kwantylowym można zaobserwować, że prawdopodobieństwa wystąpienia obserwacji znacznie oddalonych od średniej wartości (tzw. nietypowych) są znacznie wyższe niż dla rozkładu normalnego. Przeskalowany rozkład t-studenta lepiej opisuje rozkład stóp zwrotów portfela.</p>
<pre class="r"><code>q            &lt;- seq(0.001, 0.999, 0.001)
QteoNORM         &lt;- qnorm(q)        # normal distribution
QteoT  &lt;- qdist(&quot;std&quot;,p=q,shape=v) # scaled t-student dist
Qemp         &lt;- quantile(Rstar,q)         # data 

lim0    &lt;- c(-5,5)                           # range on plot
par(mfrow=c(1,2), cex = 0.7, bty=&quot;l&quot;)
plot(Qemp,QteoNORM, main=&quot;QQplot&quot;, col=&quot;red&quot;, xlim = lim0, ylim = lim0,
     xlab=&quot;empiryczny kwantyl&quot;, ylab=&quot;teoretyczny kwantyl normalny&quot;);abline(a=0,b=1, lwd=1) 
plot(Qemp,QteoT, main=&quot;QQplot&quot;, col=&quot;red&quot;, xlim = lim0, ylim = lim0,
     xlab=&quot;empiryczny kwantyl&quot;, ylab=&quot;teoretyczny skalowany kwantyl t-student&quot;);abline(a=0,b=1, lwd=1) </code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Poniższe wykresy przedstawiają wartości funkcji ACF/PACF odpowiednio dla stóp zwrotu, ich wartości bezwzględnych i kwadratów stóp zwrotu. Nie występuje wysoka autokorelacja dla stóp zwrotu, ale dla wartości bezwzględnych i kwadratów już tak. Świadczy to o możliwości występowania zjawiska grupowania wariancji.</p>
<p>Przeprowadzony został test Box-Ljung, którego hipoteza zerowa wskazuje na brak znaczącej autokorelacji dla stóp zwrotu. W przypadku stóp zwrotu brak znaczącej autokorelacji został potwierdzony, ale w przypadku wartości bezwględnych i kwadratów stóp zwrotu odrzucono hipotezę zerową o braku autokorelacji na 5% poziomie istotności.</p>
<pre class="r"><code>Acf(R, main=&quot;ACF of daily returns&quot; )</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>pacf(R, main=&quot;PACF of daily returns&quot; )</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<pre class="r"><code>Acf(abs(R), main=&quot;ACF of daily absolute returns&quot; )</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-7-3.png" width="672" /></p>
<pre class="r"><code>Acf(R^2, main=&quot;ACF of squared daily returns&quot; )</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-7-4.png" width="672" /></p>
<pre class="r"><code>Box.test(R, lag = 20, type = c(&quot;Ljung-Box&quot;))</code></pre>
<pre><code>## 
##  Box-Ljung test
## 
## data:  R
## X-squared = 21.931, df = 20, p-value = 0.3443</code></pre>
<pre class="r"><code>Box.test(R^2, lag = 20, type = c(&quot;Ljung-Box&quot;))</code></pre>
<pre><code>## 
##  Box-Ljung test
## 
## data:  R^2
## X-squared = 94.399, df = 20, p-value = 1.249e-11</code></pre>
<p>W sytuacji, gdy w modelu występuje zjawisko grupowania wariancji, tzw. efektów ARCH (następujące po sobie okresy o nasilonej lub względnie stabilnej zmienności), to wariancja składnika losowego dla różnych obserwacji jest ze sobą powiązana, co prowadzi do błędów w estymacji. Wynik testu na występowanie efektów ARCH wśród zwrotów sugeruje odrzucenie hipotezy zerowej o braku występowania efektów ARCH na poziomie 5% istotności.</p>
<pre class="r"><code>ArchTest(R)</code></pre>
<pre><code>## 
##  ARCH LM-test; Null hypothesis: no ARCH effects
## 
## data:  R
## Chi-squared = 55.913, df = 12, p-value = 1.241e-07</code></pre>
<p>Potwierdzona została także stacjonarność szeregu czasowego poprzez test KPSS i ADF.</p>
<pre class="r"><code>summary(ur.kpss(R, type = &quot;mu&quot;))</code></pre>
<pre><code>## 
## ####################### 
## # KPSS Unit Root Test # 
## ####################### 
## 
## Test is of type: mu with 8 lags. 
## 
## Value of test-statistic is: 0.028 
## 
## Critical value for a significance level of: 
##                 10pct  5pct 2.5pct  1pct
## critical values 0.347 0.463  0.574 0.739</code></pre>
<pre class="r"><code>summary(ur.kpss(R, type = &quot;tau&quot;))</code></pre>
<pre><code>## 
## ####################### 
## # KPSS Unit Root Test # 
## ####################### 
## 
## Test is of type: tau with 8 lags. 
## 
## Value of test-statistic is: 0.0291 
## 
## Critical value for a significance level of: 
##                 10pct  5pct 2.5pct  1pct
## critical values 0.119 0.146  0.176 0.216</code></pre>
<pre class="r"><code>summary(ur.df(R, type=&quot;none&quot;, selectlags=&quot;BIC&quot;))</code></pre>
<pre><code>## 
## ############################################### 
## # Augmented Dickey-Fuller Test Unit Root Test # 
## ############################################### 
## 
## Test regression none 
## 
## 
## Call:
## lm(formula = z.diff ~ z.lag.1 - 1 + z.diff.lag)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -14.7993  -1.2734   0.0518   1.3210  14.0914 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## z.lag.1    -1.001961   0.030430 -32.926   &lt;2e-16 ***
## z.diff.lag  0.005296   0.021577   0.245    0.806    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.458 on 2133 degrees of freedom
## Multiple R-squared:  0.4997, Adjusted R-squared:  0.4993 
## F-statistic:  1065 on 2 and 2133 DF,  p-value: &lt; 2.2e-16
## 
## 
## Value of test-statistic is: -32.9263 
## 
## Critical values for test statistics: 
##       1pct  5pct 10pct
## tau1 -2.58 -1.95 -1.62</code></pre>
<p>Następnie wybrano opóźnienia modelu dla średniej (ARIMA) na podstawie kryterium BIC, zakładając rozkład t-studenta. Najniższą wartość kryterium miał model ARIMA (0,0) i ten zostanie użyty.</p>
<pre class="r"><code>AC &lt;- autoarfima(R, ar.max=3, ma.max=3, criterion=&#39;BIC&#39;, method=&#39;partial&#39;, arfima=FALSE, include.mean=NULL, distribution.model=&#39;std&#39;)

kable(head(AC$rank.matrix))</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">AR</th>
<th align="right">MA</th>
<th align="right">Mean</th>
<th align="right">ARFIMA</th>
<th align="right">BIC</th>
<th align="right">converged</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4.526158</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">4.526794</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">4.526852</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">4.529016</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">4.529373</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4.529741</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Najlepszy model GARCH(p,q) został wybrany na podstawie najniższej wartości kryteriów informacyjnych. Dla logarytmicznych stóp zwrotu opisywanych rozkładem normalnym najlepszym modelem okazał się GARCH (2,2), a dla opisywanych rozkładem t-studenta GARCH (1,1).</p>
<pre class="r"><code>LagSelG &lt;- function(x, Pmax=4, Qmax=4, crit=&quot;SIC&quot;, dist=&quot;norm&quot;){
  IC &lt;- matrix(NA, Pmax, Qmax+1)
  for(p in 1:Pmax){
    for(q in 0:Qmax){
      
      spec = ugarchspec(variance.model=list(model=&quot;sGARCH&quot;, garchOrder=c(p,q)), 
                        mean.model=list(armaOrder=c(0,0), include.mean=TRUE),  
                        distribution.model=dist)
      fit  = ugarchfit(data=x, spec=spec)
      if(crit == &quot;AIC&quot;){IC[p,q+1] &lt;- infocriteria(fit)[1] }
      if(crit == &quot;SIC&quot;){IC[p,q+1] &lt;- infocriteria(fit)[2] }
      if(crit == &quot;HQ&quot;){ IC[p,q+1] &lt;- infocriteria(fit)[4] }
    }
  }
  rownames(IC) &lt;- paste(&#39;p=&#39;,1:Pmax, sep=&quot;&quot;)
  colnames(IC) &lt;- paste(&#39;q=&#39;,0:Qmax, sep=&quot;&quot;)
  return(IC)
}
LagSelG(r,4,4,crit=&quot;SIC&quot;, dist=&quot;norm&quot;) #(2,2)</code></pre>
<pre><code>##          q=0      q=1      q=2      q=3      q=4
## p=1 4.643112 4.604787 4.609238 4.613822 4.617080
## p=2 4.617927 4.606964 4.604400 4.608771 4.617375
## p=3 4.616489 4.610520 4.608785 4.612358 4.620963
## p=4 4.608129 4.611717 4.612331 4.615912 4.624551</code></pre>
<pre class="r"><code>LagSelG(r,4,4,crit=&quot;SIC&quot;, dist=&quot;std&quot;) #(1,1)</code></pre>
<pre><code>##          q=0      q=1      q=2      q=3      q=4
## p=1 4.519601 4.490058 4.494002 4.498391 4.501635
## p=2 4.509171 4.493738 4.495650 4.500470 4.503533
## p=3 4.505486 4.497676 4.499682 4.503888 4.506938
## p=4 4.503261 4.501780 4.503629 4.507309 4.509905</code></pre>
<p>Kolejnym krokiem było dopasowanie modeli do danych. Poniżej wydruki dopasowania modelu GARCH (2,2) z rozkładem normalnym i GARCH-t (1,1) z rozkładem t-studenta.</p>
<pre class="r"><code>spec0 = ugarchspec(variance.model=list(model=&quot;sGARCH&quot;, garchOrder=c(2,2)), 
                   mean.model=list(armaOrder=c(0,0), include.mean=TRUE),  
                   distribution.model=&quot;norm&quot;)
fit0 = ugarchfit(data=r, spec=spec0, solver = &quot;hybrid&quot;)

spec1 = ugarchspec(variance.model=list(model=&quot;sGARCH&quot;, garchOrder=c(1,1)), 
                   mean.model=list(armaOrder=c(0,0), include.mean=TRUE),  
                   distribution.model=&quot;std&quot;)
fit1 = ugarchfit(data=r, spec=spec1, solver=&quot;hybrid&quot;)
fit0</code></pre>
<pre><code>## 
## *---------------------------------*
## *          GARCH Model Fit        *
## *---------------------------------*
## 
## Conditional Variance Dynamics    
## -----------------------------------
## GARCH Model  : sGARCH(2,2)
## Mean Model   : ARFIMA(0,0,0)
## Distribution : norm 
## 
## Optimal Parameters
## ------------------------------------
##         Estimate  Std. Error  t value Pr(&gt;|t|)
## mu      0.092733    0.049568 1.870816 0.061371
## omega   1.440133    0.461808 3.118466 0.001818
## alpha1  0.051611    0.022303 2.314078 0.020663
## alpha2  0.141855    0.032437 4.373274 0.000012
## beta1   0.005673    0.070556 0.080403 0.935917
## beta2   0.568227    0.088741 6.403202 0.000000
## 
## Robust Standard Errors:
##         Estimate  Std. Error  t value Pr(&gt;|t|)
## mu      0.092733    0.046762 1.983067 0.047360
## omega   1.440133    1.178343 1.222168 0.221644
## alpha1  0.051611    0.037276 1.384571 0.166184
## alpha2  0.141855    0.073591 1.927621 0.053902
## beta1   0.005673    0.108256 0.052402 0.958208
## beta2   0.568227    0.193125 2.942269 0.003258
## 
## LogLikelihood : -4896.8 
## 
## Information Criteria
## ------------------------------------
##                    
## Akaike       4.5885
## Bayes        4.6044
## Shibata      4.5885
## Hannan-Quinn 4.5943
## 
## Weighted Ljung-Box Test on Standardized Residuals
## ------------------------------------
##                         statistic p-value
## Lag[1]                     0.6218  0.4304
## Lag[2*(p+q)+(p+q)-1][2]    0.6218  0.6391
## Lag[4*(p+q)+(p+q)-1][5]    2.6756  0.4695
## d.o.f=0
## H0 : No serial correlation
## 
## Weighted Ljung-Box Test on Standardized Squared Residuals
## ------------------------------------
##                          statistic p-value
## Lag[1]                     0.00122  0.9721
## Lag[2*(p+q)+(p+q)-1][11]   1.90950  0.9659
## Lag[4*(p+q)+(p+q)-1][19]   6.01401  0.8727
## d.o.f=4
## 
## Weighted ARCH LM Tests
## ------------------------------------
##             Statistic Shape Scale P-Value
## ARCH Lag[5]    0.5972 0.500 2.000  0.4396
## ARCH Lag[7]    2.1513 1.473 1.746  0.4717
## ARCH Lag[9]    2.3562 2.402 1.619  0.6888
## 
## Nyblom stability test
## ------------------------------------
## Joint Statistic:  1.7023
## Individual Statistics:              
## mu     0.06966
## omega  0.82490
## alpha1 0.38672
## alpha2 0.36352
## beta1  0.91853
## beta2  0.84972
## 
## Asymptotic Critical Values (10% 5% 1%)
## Joint Statistic:          1.49 1.68 2.12
## Individual Statistic:     0.35 0.47 0.75
## 
## Sign Bias Test
## ------------------------------------
##                    t-value   prob sig
## Sign Bias           1.5824 0.1137    
## Negative Sign Bias  0.5548 0.5791    
## Positive Sign Bias  1.2567 0.2090    
## Joint Effect        2.7833 0.4263    
## 
## 
## Adjusted Pearson Goodness-of-Fit Test:
## ------------------------------------
##   group statistic p-value(g-1)
## 1    20     84.14    3.557e-10
## 2    30     99.94    9.986e-10
## 3    40    110.09    1.063e-08
## 4    50    119.36    8.368e-08
## 
## 
## Elapsed time : 0.2183878</code></pre>
<p>Nie wszystkie parametry w modelu GARCH (2,2) są istotne. Biorąc pod uwagę odrzucenie hipotezy zerowej w teście Adjusted Pearson Goodness-of-Fit model nie jest dobrze dopasowany do danych.</p>
<pre class="r"><code>fit1</code></pre>
<pre><code>## 
## *---------------------------------*
## *          GARCH Model Fit        *
## *---------------------------------*
## 
## Conditional Variance Dynamics    
## -----------------------------------
## GARCH Model  : sGARCH(1,1)
## Mean Model   : ARFIMA(0,0,0)
## Distribution : std 
## 
## Optimal Parameters
## ------------------------------------
##         Estimate  Std. Error  t value Pr(&gt;|t|)
## mu      0.075590    0.043468   1.7390 0.082040
## omega   0.359450    0.155992   2.3043 0.021207
## alpha1  0.077054    0.022921   3.3617 0.000775
## beta1   0.866615    0.042987  20.1597 0.000000
## shape   4.544196    0.436965  10.3995 0.000000
## 
## Robust Standard Errors:
##         Estimate  Std. Error  t value Pr(&gt;|t|)
## mu      0.075590    0.041841   1.8066 0.070827
## omega   0.359450    0.224115   1.6039 0.108744
## alpha1  0.077054    0.031533   2.4436 0.014542
## beta1   0.866615    0.062615  13.8405 0.000000
## shape   4.544196    0.449354  10.1127 0.000000
## 
## LogLikelihood : -4778.459 
## 
## Information Criteria
## ------------------------------------
##                    
## Akaike       4.4768
## Bayes        4.4901
## Shibata      4.4768
## Hannan-Quinn 4.4817
## 
## Weighted Ljung-Box Test on Standardized Residuals
## ------------------------------------
##                         statistic p-value
## Lag[1]                     0.5347  0.4646
## Lag[2*(p+q)+(p+q)-1][2]    0.6186  0.6405
## Lag[4*(p+q)+(p+q)-1][5]    3.0961  0.3898
## d.o.f=0
## H0 : No serial correlation
## 
## Weighted Ljung-Box Test on Standardized Squared Residuals
## ------------------------------------
##                         statistic p-value
## Lag[1]                     0.2834  0.5945
## Lag[2*(p+q)+(p+q)-1][5]    1.8155  0.6626
## Lag[4*(p+q)+(p+q)-1][9]    3.4860  0.6768
## d.o.f=2
## 
## Weighted ARCH LM Tests
## ------------------------------------
##             Statistic Shape Scale P-Value
## ARCH Lag[3]    0.2685 0.500 2.000  0.6044
## ARCH Lag[5]    1.3653 1.440 1.667  0.6284
## ARCH Lag[7]    2.6320 2.315 1.543  0.5856
## 
## Nyblom stability test
## ------------------------------------
## Joint Statistic:  1.5774
## Individual Statistics:             
## mu     0.3566
## omega  0.7930
## alpha1 0.7167
## beta1  0.8689
## shape  0.5241
## 
## Asymptotic Critical Values (10% 5% 1%)
## Joint Statistic:          1.28 1.47 1.88
## Individual Statistic:     0.35 0.47 0.75
## 
## Sign Bias Test
## ------------------------------------
##                    t-value    prob sig
## Sign Bias           1.7842 0.07454   *
## Negative Sign Bias  1.3222 0.18624    
## Positive Sign Bias  0.7579 0.44858    
## Joint Effect        3.4237 0.33080    
## 
## 
## Adjusted Pearson Goodness-of-Fit Test:
## ------------------------------------
##   group statistic p-value(g-1)
## 1    20     17.53       0.5543
## 2    30     26.52       0.5974
## 3    40     40.43       0.4071
## 4    50     45.52       0.6149
## 
## 
## Elapsed time : 0.213439</code></pre>
<p>W modelu Garch-t(1,1) suma parametrów alfa i beta jest mniejsza od 1, co wskazuje na stacjonarność wariancji i powracanie do średniej wartości. Wszystkie parametry są dodatnie i istotne statystycznie. Wyniki testu Weighted Ljung-Box na standaryzowanych kwadratach reszt sugerują, aby nie odrzucać hipotezy zerowej o braku autokorelacji. Natomiast wartości p-value testu mnożników Lagrange’a na występowanie efektów ARCH wśród wystandaryzowanych reszt świadczą o tym, że nie można odrzucić hipotezy o niewystępowaniu efektów ARCH. Model Garch-t(1,1) spełnia wytyczne dobrze dopasowanego modelu.</p>
<p>Poniższy wykres sugeruje występowanie efektu dźwigni w szeregu zwrotów, czyli asymetrycznego wpływu informacji na poziom przyszłej wariancji. Dlatego dalej w analizie rozważone zostaną także asymetryczne modele GARCH z rozkładem t-studenta.</p>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code>spec.e   = ugarchspec(variance.model=list(model=&quot;eGARCH&quot;, garchOrder=c(1,1)), 
                      mean.model=list(armaOrder=c(0,0), include.mean=TRUE),  
                      distribution.model=&quot;std&quot;)
spec.gjr = ugarchspec(variance.model=list(model=&quot;gjrGARCH&quot;, garchOrder=c(1,1)), 
                      mean.model=list(armaOrder=c(0,0), include.mean=TRUE),  
                      distribution.model=&quot;std&quot;)

fit.e   = ugarchfit(data=r, spec=spec.e,solver=&quot;hybrid&quot;)  
fit.gjr = ugarchfit(data=r, spec=spec.gjr,solver=&quot;hybrid&quot;)
IC &lt;- cbind(infocriteria(fit1), infocriteria(fit.e), infocriteria(fit.gjr))
colnames(IC) &lt;- c(&quot;GARCH&quot;, &quot;eGARCH&quot;, &quot;gjrGARCH&quot;)
IC</code></pre>
<pre><code>##                 GARCH   eGARCH gjrGARCH
## Akaike       4.476799 4.469471 4.474391
## Bayes        4.490058 4.485383 4.490303
## Shibata      4.476788 4.469456 4.474375
## Hannan-Quinn 4.481651 4.475294 4.480214</code></pre>
<p>Najniższa wartość kryteriów informacyjnych jest dla modelu eGARCH.</p>
<pre class="r"><code>fit.e</code></pre>
<pre><code>## 
## *---------------------------------*
## *          GARCH Model Fit        *
## *---------------------------------*
## 
## Conditional Variance Dynamics    
## -----------------------------------
## GARCH Model  : eGARCH(1,1)
## Mean Model   : ARFIMA(0,0,0)
## Distribution : std 
## 
## Optimal Parameters
## ------------------------------------
##         Estimate  Std. Error  t value Pr(&gt;|t|)
## mu      0.055490    0.042885   1.2939 0.195689
## omega   0.060530    0.004518  13.3979 0.000000
## alpha1 -0.052285    0.015486  -3.3762 0.000735
## beta1   0.964726    0.001371 703.7493 0.000000
## gamma1  0.135080    0.025372   5.3239 0.000000
## shape   4.571691    0.439263  10.4076 0.000000
## 
## Robust Standard Errors:
##         Estimate  Std. Error   t value Pr(&gt;|t|)
## mu      0.055490    0.042552    1.3040 0.192219
## omega   0.060530    0.003957   15.2973 0.000000
## alpha1 -0.052285    0.018424   -2.8379 0.004541
## beta1   0.964726    0.000175 5500.3814 0.000000
## gamma1  0.135080    0.025739    5.2480 0.000000
## shape   4.571691    0.447650   10.2127 0.000000
## 
## LogLikelihood : -4769.63 
## 
## Information Criteria
## ------------------------------------
##                    
## Akaike       4.4695
## Bayes        4.4854
## Shibata      4.4695
## Hannan-Quinn 4.4753
## 
## Weighted Ljung-Box Test on Standardized Residuals
## ------------------------------------
##                         statistic p-value
## Lag[1]                     0.6567  0.4177
## Lag[2*(p+q)+(p+q)-1][2]    0.7663  0.5807
## Lag[4*(p+q)+(p+q)-1][5]    2.8548  0.4342
## d.o.f=0
## H0 : No serial correlation
## 
## Weighted Ljung-Box Test on Standardized Squared Residuals
## ------------------------------------
##                         statistic p-value
## Lag[1]                     0.1999  0.6548
## Lag[2*(p+q)+(p+q)-1][5]    2.2353  0.5640
## Lag[4*(p+q)+(p+q)-1][9]    3.6051  0.6563
## d.o.f=2
## 
## Weighted ARCH LM Tests
## ------------------------------------
##             Statistic Shape Scale P-Value
## ARCH Lag[3]    0.1048 0.500 2.000  0.7461
## ARCH Lag[5]    1.1160 1.440 1.667  0.6988
## ARCH Lag[7]    1.9503 2.315 1.543  0.7278
## 
## Nyblom stability test
## ------------------------------------
## Joint Statistic:  1.3159
## Individual Statistics:              
## mu     0.24174
## omega  0.52452
## alpha1 0.20017
## beta1  0.57311
## gamma1 0.08792
## shape  0.22520
## 
## Asymptotic Critical Values (10% 5% 1%)
## Joint Statistic:          1.49 1.68 2.12
## Individual Statistic:     0.35 0.47 0.75
## 
## Sign Bias Test
## ------------------------------------
##                    t-value    prob sig
## Sign Bias            1.844 0.06536   *
## Negative Sign Bias   1.463 0.14350    
## Positive Sign Bias   1.598 0.11022    
## Joint Effect         4.865 0.18194    
## 
## 
## Adjusted Pearson Goodness-of-Fit Test:
## ------------------------------------
##   group statistic p-value(g-1)
## 1    20     19.23       0.4423
## 2    30     24.92       0.6822
## 3    40     38.18       0.5071
## 4    50     41.50       0.7679
## 
## 
## Elapsed time : 0.514626</code></pre>
<p>Wszystkie parametry oprócz “mu” są statystycznie istotne. Nie występuje autokorelacja reszt ani efekty ARCH dla wariancji. Na podstawie uzyskanych oszacowań można wnioskować, że występuje efekt asymetrycznego wpływu informacji, gdyż alfa jest istotna i przyjmuje wartość ujemną, więc wskazuje to na większy wpływ szoków ujemnych. Parametr gamma również jest istotny.</p>
<p>W celu zbadania czy większa warunkowa zmienność powoduje większy zwrot, czyli czy występuje tzw. “premia za ryzyko” oszacowano model GARCH-in-mean. Współczynnik archm jest statystycznie istotny na poziomie 5%, więc występuje premia za ryzyko.Jednakże na podstawie krytieriów informacyjnych model eGARCH wydaje się być nadal najlepszy.</p>
<pre class="r"><code>spec.m = ugarchspec(variance.model=list(model=&quot;eGARCH&quot;, garchOrder=c(1,1)), 
                    mean.model=list(armaOrder=c(0,0), include.mean=TRUE, archm = TRUE), distribution.model=&quot;std&quot;)
fit.m  = ugarchfit(data=r, spec=spec.m, solver = &quot;hybrid&quot;)

IC &lt;- cbind(infocriteria(fit1), infocriteria(fit.e), infocriteria(fit.gjr), infocriteria(fit.m))
colnames(IC) &lt;- c(&quot;GARCH&quot;, &quot;eGARCH&quot;, &quot;gjrGARCH&quot;,&quot;GARCH-in-mean&quot;)
IC</code></pre>
<pre><code>##                 GARCH   eGARCH gjrGARCH GARCH-in-mean
## Akaike       4.476799 4.469471 4.474391      4.470225
## Bayes        4.490058 4.485383 4.490303      4.488788
## Shibata      4.476788 4.469456 4.474375      4.470203
## Hannan-Quinn 4.481651 4.475294 4.480214      4.477018</code></pre>
<p>Poniżej sporządzono także różne wykresy kolejno dla modeli GARCH, eGARCH, eGARCH-in-mean</p>
<p>Wykres zwrotów z warunkowym odchyleniem standardowym</p>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-18-1.png" width="672" /><img src="GARCH_practise_files/figure-html/unnamed-chunk-18-2.png" width="672" /><img src="GARCH_practise_files/figure-html/unnamed-chunk-18-3.png" width="672" /></p>
<p>Zwroty z 1% limitem VaR</p>
<pre><code>## 
## please wait...calculating quantiles...</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre><code>## 
## please wait...calculating quantiles...</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-19-2.png" width="672" /></p>
<pre><code>## 
## please wait...calculating quantiles...</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-19-3.png" width="672" /></p>
<p>Empiryczna gęstość wystandaryzowanych reszt</p>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-20-1.png" width="672" /><img src="GARCH_practise_files/figure-html/unnamed-chunk-20-2.png" width="672" /><img src="GARCH_practise_files/figure-html/unnamed-chunk-20-3.png" width="672" /></p>
<p>ACF wystandaryzowanych reszt</p>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-21-1.png" width="672" /><img src="GARCH_practise_files/figure-html/unnamed-chunk-21-2.png" width="672" /><img src="GARCH_practise_files/figure-html/unnamed-chunk-21-3.png" width="672" /></p>
<p>ACF wystandaryzowanych kwadratów reszt</p>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-22-1.png" width="672" /><img src="GARCH_practise_files/figure-html/unnamed-chunk-22-2.png" width="672" /><img src="GARCH_practise_files/figure-html/unnamed-chunk-22-3.png" width="672" /></p>
<p>Krzywa wpływu informacji</p>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-23-1.png" width="672" /><img src="GARCH_practise_files/figure-html/unnamed-chunk-23-2.png" width="672" /><img src="GARCH_practise_files/figure-html/unnamed-chunk-23-3.png" width="672" /></p>
<p>Następnie dokonano estymacji modeli z zastosowaniem funkcji ugarchroll w celu analizy VaR w okresie out-of-sample. Okres out-of-sample ustalono na 500 obserwacji. Pozostałe 1637 obserwacji będzie stanowiło okres in-sample. Została wybrana opcja reksursywnego okna i ponownej esytmacji co 25 obserwacji, co oznacza że pierwsza prognoza (dla 25 obserwacji) będzie obliczana na podstawie modelu estymowanego z 1637 obserwacji, kolejna na bazie modelu estymowanego z 1637+25, kolejna na bazie modelu z obserwacji 1637+25+25,itd. Wygenerowane zostały raporty które pozwolą na tzw. backtesting modeli, m.in. sprawdzenie poprawnej ilości przekroczeń VaR</p>
<pre class="r"><code>roll1 = ugarchroll(spec1 , data = r, forecast.length = 500, n.ahead = 1, refit.every = 25, refit.window = &#39;recursive&#39;, calculate.VaR = TRUE, solver = &#39;hybrid&#39;, VaR.alpha = c(0.01,0.05))
rolle = ugarchroll(spec.e, data = r, forecast.length = 500, n.ahead = 1, refit.every = 25, refit.window = &#39;recursive&#39;, calculate.VaR = TRUE, solver = &#39;hybrid&#39;, VaR.alpha = c(0.01,0.05))
rollm = ugarchroll(spec.m, data = r, forecast.length = 500, n.ahead = 1, refit.every = 25, refit.window = &#39;recursive&#39;, calculate.VaR = TRUE, solver = &#39;hybrid&#39;, VaR.alpha = c(0.01,0.05))
# Generate the 1% VaR report
report(roll1, VaR.alpha = 0.01)</code></pre>
<pre><code>## VaR Backtest Report
## ===========================================
## Model:               sGARCH-std
## Backtest Length: 500
## Data:                
## 
## ==========================================
## alpha:               1%
## Expected Exceed: 5
## Actual VaR Exceed:   5
## Actual %:            1%
## 
## Unconditional Coverage (Kupiec)
## Null-Hypothesis: Correct Exceedances
## LR.uc Statistic: 0
## LR.uc Critical:      3.841
## LR.uc p-value:       1
## Reject Null:     NO
## 
## Conditional Coverage (Christoffersen)
## Null-Hypothesis: Correct Exceedances and
##                  Independence of Failures
## LR.cc Statistic: 0.101
## LR.cc Critical:      5.991
## LR.cc p-value:       0.951
## Reject Null:     NO</code></pre>
<pre class="r"><code>report(rolle, VaR.alpha = 0.01)</code></pre>
<pre><code>## VaR Backtest Report
## ===========================================
## Model:               eGARCH-std
## Backtest Length: 500
## Data:                
## 
## ==========================================
## alpha:               1%
## Expected Exceed: 5
## Actual VaR Exceed:   6
## Actual %:            1.2%
## 
## Unconditional Coverage (Kupiec)
## Null-Hypothesis: Correct Exceedances
## LR.uc Statistic: 0.19
## LR.uc Critical:      3.841
## LR.uc p-value:       0.663
## Reject Null:     NO
## 
## Conditional Coverage (Christoffersen)
## Null-Hypothesis: Correct Exceedances and
##                  Independence of Failures
## LR.cc Statistic: 0.336
## LR.cc Critical:      5.991
## LR.cc p-value:       0.845
## Reject Null:     NO</code></pre>
<pre class="r"><code>report(rollm, VaR.alpha = 0.01)</code></pre>
<pre><code>## VaR Backtest Report
## ===========================================
## Model:               eGARCH-std
## Backtest Length: 500
## Data:                
## 
## ==========================================
## alpha:               1%
## Expected Exceed: 5
## Actual VaR Exceed:   6
## Actual %:            1.2%
## 
## Unconditional Coverage (Kupiec)
## Null-Hypothesis: Correct Exceedances
## LR.uc Statistic: 0.19
## LR.uc Critical:      3.841
## LR.uc p-value:       0.663
## Reject Null:     NO
## 
## Conditional Coverage (Christoffersen)
## Null-Hypothesis: Correct Exceedances and
##                  Independence of Failures
## LR.cc Statistic: 0.336
## LR.cc Critical:      5.991
## LR.cc p-value:       0.845
## Reject Null:     NO</code></pre>
<p>Najmniej przekroczeń oszacowanej wartości narażonej na ryzyko przy poziomie istotności 1% uzyskał standardowy model GARCH. W żadnym z modeli nie odrzucono hipotezy zerowej zakładającej poprawną ilość przekroczeń i niezależność.</p>
<pre class="r"><code># Generate the 5% VaR report
report(roll1, VaR.alpha = 0.05)</code></pre>
<pre><code>## VaR Backtest Report
## ===========================================
## Model:               sGARCH-std
## Backtest Length: 500
## Data:                
## 
## ==========================================
## alpha:               5%
## Expected Exceed: 25
## Actual VaR Exceed:   32
## Actual %:            6.4%
## 
## Unconditional Coverage (Kupiec)
## Null-Hypothesis: Correct Exceedances
## LR.uc Statistic: 1.903
## LR.uc Critical:      3.841
## LR.uc p-value:       0.168
## Reject Null:     NO
## 
## Conditional Coverage (Christoffersen)
## Null-Hypothesis: Correct Exceedances and
##                  Independence of Failures
## LR.cc Statistic: 3.614
## LR.cc Critical:      5.991
## LR.cc p-value:       0.164
## Reject Null:     NO</code></pre>
<pre class="r"><code>report(rolle, VaR.alpha = 0.05)</code></pre>
<pre><code>## VaR Backtest Report
## ===========================================
## Model:               eGARCH-std
## Backtest Length: 500
## Data:                
## 
## ==========================================
## alpha:               5%
## Expected Exceed: 25
## Actual VaR Exceed:   33
## Actual %:            6.6%
## 
## Unconditional Coverage (Kupiec)
## Null-Hypothesis: Correct Exceedances
## LR.uc Statistic: 2.459
## LR.uc Critical:      3.841
## LR.uc p-value:       0.117
## Reject Null:     NO
## 
## Conditional Coverage (Christoffersen)
## Null-Hypothesis: Correct Exceedances and
##                  Independence of Failures
## LR.cc Statistic: 3.897
## LR.cc Critical:      5.991
## LR.cc p-value:       0.142
## Reject Null:     NO</code></pre>
<pre class="r"><code>report(rollm, VaR.alpha = 0.05)</code></pre>
<pre><code>## VaR Backtest Report
## ===========================================
## Model:               eGARCH-std
## Backtest Length: 500
## Data:                
## 
## ==========================================
## alpha:               5%
## Expected Exceed: 25
## Actual VaR Exceed:   34
## Actual %:            6.8%
## 
## Unconditional Coverage (Kupiec)
## Null-Hypothesis: Correct Exceedances
## LR.uc Statistic: 3.081
## LR.uc Critical:      3.841
## LR.uc p-value:       0.079
## Reject Null:     NO
## 
## Conditional Coverage (Christoffersen)
## Null-Hypothesis: Correct Exceedances and
##                  Independence of Failures
## LR.cc Statistic: 4.272
## LR.cc Critical:      5.991
## LR.cc p-value:       0.118
## Reject Null:     NO</code></pre>
<p>Najmniej przekroczeń oszacowanej wartości narażonej na ryzyko przy poziomie istotności 5% uzyskał również standardowy model GARCH. W żadnym z modeli nie odrzucono hipotezy zerowej zakładającej poprawną ilość przekroczeń i niezależność, co jest istotnym powodem do uznania wszystkie modele za poprawnie skonstruowane.</p>
<p>Poniżej przedstawiono wykresy, które obrazują kiedy wartość VaR została przekroczona w tzw. rolling prognozach kolejno dla modeli GARCH, eGARCH, GARCH-in-mean na poziomie istotności 1%.</p>
<pre class="r"><code>D = as.POSIXct(rownames(roll1@forecast$VaR))
VaRplot(0.01, actual = xts(roll1@forecast$VaR[, 3], D), VaR = xts(roll1@forecast$VaR[,1], D, xlab = &quot;Data&quot;))</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<pre class="r"><code>VaRplot(0.01, actual = xts(rolle@forecast$VaR[, 3], D), VaR = xts(rolle@forecast$VaR[,1], D, xlab = &quot;Data&quot;))</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-26-2.png" width="672" /></p>
<pre class="r"><code>VaRplot(0.01, actual = xts(rollm@forecast$VaR[, 3], D), VaR = xts(rollm@forecast$VaR[,1], D, xlab = &quot;Data&quot;))</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-26-3.png" width="672" /></p>
<p>Tutaj wykresy przekroczenia VaR dla poziomu 5%.</p>
<pre class="r"><code>VaRplot(0.05, actual = xts(roll1@forecast$VaR[, 3], D), VaR = xts(roll1@forecast$VaR[,2], D, xlab = &quot;Data&quot;))</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<pre class="r"><code>VaRplot(0.05, actual = xts(rolle@forecast$VaR[, 3], D), VaR = xts(rolle@forecast$VaR[,2], D, xlab = &quot;Data&quot;))</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-27-2.png" width="672" /></p>
<pre class="r"><code>VaRplot(0.05, actual = xts(rollm@forecast$VaR[, 3], D), VaR = xts(rollm@forecast$VaR[,2], D, xlab = &quot;Data&quot;))</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-27-3.png" width="672" /></p>
<p>Poniżej stworzono także wykres ze zrealizowanymi zwrotami, VaR (Value at Risk) i ES (Expected Shortfall) wyliczonych na podstawie modelu GARCH (1,1).</p>
<pre class="r"><code>df1_var &lt;- as.data.frame(roll1@forecast, which = &quot;density&quot;) 

f = function(x, skew, shape) qdist(&quot;std&quot;, p = x, mu = 0, sigma = 1, skew = skew, shape = shape) 

test_es = df1_var[&#39;density.Mu&#39;] + df1_var[&#39;density.Sigma&#39;]*apply(df1_var, 1, function(x) 
  integrate(f,0,0.01, skew = x[&#39;density.Skew&#39;], shape = x[&#39;density.Shape&#39;])$value/0.01) 

test_es &lt;- as.zoo(as.xts(test_es)) 
test_es &lt;- aggregate(test_es, function(tt) as.Date(tt, tz = &quot;&quot;)) #convert to date 

test_es5 = df1_var[&#39;density.Mu&#39;] + df1_var[&#39;density.Sigma&#39;]*apply(df1_var, 1, function(x) 
  integrate(f,0,0.05, skew = x[&#39;density.Skew&#39;], shape = x[&#39;density.Shape&#39;])$value/0.05) 

test_es5 &lt;- as.zoo(as.xts(test_es5)) 
test_es5 &lt;- aggregate(test_es5, function(tt) as.Date(tt, tz = &quot;&quot;))

dates1 &lt;- seq(from = as.Date(&quot;2017-07-10&quot;), to = as.Date(&quot;2019-07-03&quot;), by = 60)
par(mfrow=c(1,1), cex = 0.7, bty=&quot;l&quot;)
plot(as.zoo(roll1@forecast$VaR[1]),type = &quot;l&quot;, pch = 16, ylim=c(min(test_es):max(roll1@forecast$VaR[3])),col=&#39;blue&#39;,ylab=&quot;Value&quot;,xlab=&quot;Time&quot;,xaxt = &quot;n&quot;)
axis.Date(side=1, at = dates1, format=&quot;%m-%Y&quot;)
lines(as.zoo(test_es),col=&#39;red&#39;)
legend(x=&quot;topright&quot;,y=0.95,legend=c(&quot;VaR&quot;,&quot;ES&quot;,&quot;Realized&quot;),col=c(&quot;blue&quot;, &quot;red&quot;,&quot;black&quot;), lty=1, cex=0.8)
lines(as.zoo(roll1@forecast$VaR[3]),col=&quot;black&quot;)</code></pre>
<p><img src="GARCH_practise_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Na koniec przeprowadzony został McNeil and Frey test na poprawnie skalibrowaną oczekiwaną stratę (ES). Nie odrzucono hipotezy zerowej o poprawnej kalibracji zarówno na poziomie istotności 1% i 5%, co sugeruje poprawnie skalibrowany oczekiwany spadek.</p>
<pre class="r"><code># McNeila and Frey test for well calibrated Expected Shortfall
temp1 &lt;- ESTest(alpha = 0.01, roll1@forecast$VaR[, 3], test_es, roll1@forecast$VaR[,1])
temp1$p.value</code></pre>
<pre><code>## [1] 0.5145117</code></pre>
<pre class="r"><code>temp5 &lt;- ESTest(alpha = 0.05, roll1@forecast$VaR[, 3], test_es5, roll1@forecast$VaR[,2])
temp5$p.value</code></pre>
<pre><code>## [1] 0.7895588</code></pre>
<p>Podsumowanie:</p>
<p>Pod względem kryteriów informacyjnych najlepszy okazał się model eGARCH (1,1), jednakże model GARCH (1,1) uzyskał najmnieszą ilość przekroczeń oszacowanych wartości VaR. W obu modelach zastosowany został rozkład t-studenta ze względu na leptokurtyczność rozkładu zwrotów. Nie udało się jednoznacznie potwierdzić przewagi któregoś z nich w opisywaniu zmienności zwrotów wybranego portfela.</p>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
